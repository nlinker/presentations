<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>Advanced Data Structures 2</title>

    <link rel="stylesheet" href="css/reveal.css">
    <link rel="stylesheet" href="css/theme/black.css">

    <!-- Theme used for syntax highlighting of code -->
    <link rel="stylesheet" href="lib/css/zenburn.css">

    <!-- Printing and PDF exports -->
    <script>
        var link = document.createElement('link');
        link.rel = 'stylesheet';
        link.type = 'text/css';
        link.href = window.location.search.match(/print-pdf/gi) ? 'css/print/pdf.css' : 'css/print/paper.css';
        document.getElementsByTagName('head')[0].appendChild(link);
    </script>
    <style>
        .info {
            display: inline-block;
        }

        .textclass {
            float: left;
            width: 500px;
            height: 227px;
            line-height: 227px;
        }

        .imageclass {
            float: right;
            width: 200px;
            height: 227px;
        }
    </style>
</head>
<body>
<div class="reveal">
    <div class="slides">
        <!-------------------------------------------------------------------------------------------------->
        <section data-markdown="" data-background="img/ads-00-background.png">
            <script type="text/template">
                # Advanced data structures
                ## part 2
                <div class="fragment fade-up info">
                    <span class="textclass">Nick Linker</span>
                    <img class="imageclass" src="img/ads-01-issart-logo.png"/>
                </div>
                <!--nlinker.github.io/presentations/06_advanced-data-structures-2-->
            </script>
        </section>

        <section data-markdown="">
            <script type="text/template">
                ### Functional data structures
                0. Motivation
                1. Functional list
                2. Functional queue/deque
                3. Functional tree
                4. Functional hash map and vector
                5. Functional red-black tree
            </script>
        </section>

        <section data-markdown="">
            <script type="text/template">
                ### Motivation
                1. Compositional, easier to reason about
                2. Easier to test
                3. Time-travel
                4. Nice for concurrency
                5. Some operations are faster (e.g. detect changes)

                _Chris Okasaki "Purely functional data structures"_
            </script>
        </section>


        <section data-markdown="">
            <script type="text/template">
                ## Functional list
            </script>
        </section>
        <section data-markdown="" data-transition="none">
            <script type="text/template">
                ### Functional list, 0
                ```
                let x0 = ["c", "b", "a"]
                let x1 = "d" : x0
                let x2 = "e" : x0
                let x3 = "f" : x2
                let x4 = delete "c" x1
                ```
            </script>
        </section>
        <section data-markdown="" data-transition="none">
            <script type="text/template">
                ### Functional list, 1
                ```
                let x0 = ["c", "b", "a"]
                let x1 = "d" : x0
                let x2 = "e" : x0
                let x3 = "f" : x2
                let x4 = delete "c" x1
                ```
                <img height="400" src="img/ads-02-stack-1.png"/>
            </script>
        </section>

        <section data-markdown="" data-transition="none">
            <script type="text/template">
                ### Functional list, 2
                ```
                let x0 = ["c", "b", "a"]
                let x1 = "d" : x0
                let x2 = "e" : x0
                let x3 = "f" : x2
                let x4 = delete "c" x1
                ```
                <img height="400" src="img/ads-02-stack-2.png"/>
            </script>
        </section>

        <section data-markdown="" data-transition="none">
            <script type="text/template">
                ### Functional list, 3
                ```
                let x0 = ["c", "b", "a"]
                let x1 = "d" : x0
                let x2 = "e" : x0
                let x3 = "f" : x2
                let x4 = delete "c" x1
                ```
                <img height="400" src="img/ads-02-stack-3.png"/>
            </script>
        </section>

        <section data-markdown="" data-transition="none">
            <script type="text/template">
                ### Functional list, 4
                ```
                let x0 = ["c", "b", "a"]
                let x1 = "d" : x0
                let x2 = "e" : x0
                let x3 = "f" : x2
                let x4 = delete "c" x1
                ```
                <img height="400" src="img/ads-02-stack-4.png"/>
            </script>
        </section>


        <section data-markdown="">
            <script type="text/template">
                ## Functional deque
            </script>
        </section>
        <section data-markdown="" data-transition="none">
            <script type="text/template">
                ### Functional deque, 0
                1. putFirst, putLast
                2. takeFirst, takeLast
                3. also concat, size, map/filter/fold
                4. aka `BankersQueue` (from Okasaki)
            </script>
        </section>
        <section data-markdown="" data-transition="none">
            <script type="text/template">
                ### Functional deque, 1
                1. putFirst, putLast
                2. takeFirst, takeLast

                <img height="400" src="img/ads-03-deque-1.png"/>
            </script>
        </section>
        <section data-markdown="" data-transition="none">
            <script type="text/template">
                ### Functional deque, 2
                1. putFirst, putLast
                2. takeFirst, takeLast

                <img height="400" src="img/ads-03-deque-2.png"/>
            </script>
        </section>
        <section data-markdown="" data-transition="none">
            <script type="text/template">
                ### Functional deque, 3
                1. putFirst, putLast
                2. takeFirst, takeLast

                <img height="400" src="img/ads-03-deque-3.png"/>
            </script>
        </section>
        <section data-markdown="" data-transition="none">
            <script type="text/template">
                ### Functional deque, 4
                1. putFirst, putLast
                2. takeFirst, takeLast

                <img height="400" src="img/ads-03-deque-4.png"/>
            </script>
        </section>
        <section data-markdown="" data-transition="none">
            <script type="text/template">
                ### Functional deque, 5
                1. putFirst, putLast
                2. takeFirst, takeLast

                <img height="400" src="img/ads-03-deque-5.png"/>
            </script>
        </section>
        <section data-markdown="" data-transition="none">
            <script type="text/template">
                ### Functional deque, 6
                1. putFirst, putLast
                2. takeFirst, takeLast

                <img height="400" src="img/ads-03-deque-6.png"/>
            </script>
        </section>
        <section data-markdown="" data-transition="none">
            <script type="text/template">
                ### Functional deque, 7
                1. putFirst, putLast
                2. takeFirst, takeLast

                <img height="400" src="img/ads-03-deque-7.png"/>
            </script>
        </section>
        <section data-markdown="" data-transition="none">
            <script type="text/template">
                ### Functional deque, 8
                1. putFirst, putLast
                2. takeFirst, takeLast

                <img height="400" src="img/ads-03-deque-8.png"/>
            </script>
        </section>
        <section data-markdown="" data-transition="none">
            <script type="text/template">
                ### Functional deque, 9
                1. putFirst, putLast
                2. takeFirst, takeLast

                <img height="400" src="img/ads-03-deque-9.png"/>
            </script>
        </section>


        <section data-markdown="">
            <script type="text/template">
                ## Functional trees
            </script>
        </section>
        <section data-markdown="" data-transition="none">
            <script type="text/template">
                ### Functional trees, 1
                1. Share as much as possible
                2. Path copying

                <img height="400" src="img/ads-04-tree-1.png">
            </script>
        </section>
        <section data-markdown="" data-transition="none">
            <script type="text/template">
                ### Functional trees, 2
                1. Share as much as possible
                2. Path copying

                <img height="400" src="img/ads-04-tree-2.png">
            </script>
        </section>
        <section data-markdown="" data-transition="none">
            <script type="text/template">
                ### Functional trees, 3
                1. Share as much as possible
                2. Path copying

                <img height="400" src="img/ads-04-tree-3.png">
            </script>
        </section>
        <section data-markdown="" data-transition="none">
            <script type="text/template">
                ### Functional trees, 4
                1. Share as much as possible
                2. Path copying

                <img height="400" src="img/ads-04-tree-4.png">
            </script>
        </section>


        <section data-markdown="">
            <script type="text/template">
                ## Functional hash map
            </script>
        </section>
        <section data-markdown="" data-transition="none">
            <script type="text/template">
                ### Functional hash map, 1
                1. Persistent bit-partitioned hash trie
                1. Path copying
                1. Integer hash split by 5 bits
                ```
                hashCode = 0xCAFEBABE
                ```

                level  |6 |5    |4    |3    |2    |1    |0
                -------|--|-----|-----|-----|-----|-----|-----
                bits   |11|00101|01111|11101|01110|10101|11110
                index  |3 |5    |15   |29   |14   |21   |30
            </script>
        </section>
        <section data-markdown="" data-transition="none">
            <script type="text/template">
                ### Functional hash map, 2

                <img src="img/ads-05-hashmap-1.png">
            </script>
        </section>
        <section data-markdown="" data-transition="none">
            <script type="text/template">
                ### Functional hash map, 3
                ```
                hashCode = 0xCAFEBABE
                ```
                level  |6 |5    |4    |3    |2    |1    |0
                -------|--|-----|-----|-----|-----|-----|-----
                bits   |11|00101|01111|11101|01110|10101|11110
                index  |3 |5    |15   |29   |14   |21   |30

                <img src="img/ads-05-hashmap-2.png">
            </script>
        </section>
        <section data-markdown="" data-transition="none">
            <script type="text/template">
                ### Functional hash map, 4

                1. What to do with the last 2 bits?
                2. What if we want to have array, not hashmap?

                <img src="img/ads-05-hashmap-2.png">
            </script>
        </section>

        <section data-markdown="">
            <script type="text/template">
                ## Functional red-black tree
            </script>
        </section>
        <section data-markdown="" data-transition="none">
            <script type="text/template">
                ### Functional RB tree, definition

                1. No red node has red parent
                2. Every root-to-leaf path contains the same number of black nodes
                3. New inserted node is red
                4. Root is black

            </script>
        </section>
        <section data-markdown="" data-transition="none">
            <script type="text/template">
                ### Functional RB tree, insert

                ```haskell
                data Color = R | B
                data Tree a = E | T Color (Tree a) a (Tree a)

                insert :: Ord a => a -> Tree a -> Tree a
                insert x t =
                  let T _ a y b = ins t in
                  T B a y b
                  where
                    ins E          =  T R E x E
                    ins s@(T col a y b)
                      | x < y      =  balance col (ins a) y b
                      | x > y      =  balance col a y (ins b)
                      | otherwise  =  s
                ```
            </script>
        </section>
        <section data-markdown="" data-transition="none">
            <script type="text/template">
                ### Functional RB tree, balance

                ```haskell
                balance :: Color -> Tree a -> a -> Tree a -> Tree a
                balance B (T R (T R a x b) y c ) z d = T R (T B a x b) y (T B c z d)
                balance B (T R a x (T R b y c)) z d  = T R (T B a x b) y (T B c z d)
                balance B a x (T R (T R b y c) z d ) = T R (T B a x b) y (T B c z d)
                balance B a x (T R b y (T R c z d))  = T R (T B a x b) y (T B c z d)
                balance col a x b = T col a x b
                ```
                <img height="350" src="img/ads-06-red-black-tree.png"/>
            </script>
        </section>
        <section data-markdown="" data-transition="none">
            <script type="text/template">
                ### Functional RB tree, deletion

                What about deletion?

                - In Okasaki book the deletion is left for the reader :-)
                - And _it is_ hard!
                - [The missing method: Deleting from Okasaki's red-black trees](http://matt.might.net/articles/red-black-delete/)

                <img height="250" src="img/ads-06-red-black-tree-deletion.png" />
            </script>
        </section>

        <section data-markdown="">
            <script type="text/template">
                ### Trees everywhere
                <img height="500" src="img/ads-18-persistent-tree-lul.png" />
            </script>
        </section>

        <section data-markdown="">
            <script type="text/template" >
                ### Questions?
                <img src="img/ads-19-philoceraptor.jpg"/>
            </script>
        </section>

        <!-------------------------------------------------------------------------------------------------->
    </div>
</div>

<script src="lib/js/head.min.js"></script>
<script src="js/reveal.js"></script>

<script>
    // More info about config & dependencies:
    // - https://github.com/hakimel/reveal.js#configuration
    // - https://github.com/hakimel/reveal.js#dependencies
    Reveal.initialize({
        dependencies: [
            {src: 'plugin/markdown/marked.js'},
            {src: 'plugin/markdown/markdown.js'},
            {src: 'plugin/notes/notes.js', async: true},
            {
                src: 'plugin/highlight/highlight.js',
                async: true,
                callback: function () { hljs.initHighlightingOnLoad(); }
            }
        ]
    });
</script>
</body>
</html>
