### №4. Почему в Расте нет исключений?

- Исключения небесплатны
- Исключения требуют поддержки компилятора и среды исполнения, проблемы с портированием
- Некоторые исключения фатальны (OOM)
- Исключения порождают альтернативный поток исполнения (особенно больно в МП/async)
```java
public class HelloGoodbye {
    public static void main(String[] args) {
        try {
            System.out.println("Hello world");
            System.exit(0);
        } finally {
            System.out.println("Goodbye world");
        }
    }
}
```
Напишет ли нам программа "Goodbye world"?

---------------------------------------------------------------------------------------------------


### Классификация ошибок

1. Неисправимые ошибки (unrecoverable)
   - **Примеры**: _деление на 0, выход за пределы массива, OOM, фатальное нарушение инварианта_
2. Исправимые ошибки (recoverable)
   - **Примеры**: _ошибки при соединении с базой данных, ошибки парсинга JSON, ошибки поиска значения_
   - Ошибки в библиотеках
   - Ошибки приложения

```rust
enum Result<T, E> {
  Ok(T),  // success
  Err(E),  // error (или что считаем за ошибку)
}
```
---------------------------------------------------------------------------------------------------


### Преимущества:
1. Значения `Result` отлично композятся, их можно собрать в коллекцию, (де)сериализовать, распечатать для отладки
2. Система типов делает невозможным игнорирование возможной ошибки (_исключения <?> коды возврата_)
3. Значения `Result` явно получаются после асинхронных вызовов, после чего их можно проанализировать как обычные значения
4. Rust обеспечивает под держку в виде типов, анализа исчерпывания в `match` и оператора `?`

---------------------------------------------------------------------------------------------------


### Исключения vs коды возврата

Лучшее из двух подходов:
```rust
fn read_number_from_file(file_path: &str) -> Result<i32, io::Error> {
    let contents = fs::read_to_string(file_path)?;
    let number: i32 = contents.trim().parse()?;
    Ok(number)
}
```
Композиция:
```rust
fn test() {
    let xs = ["11", "22", "33wow"]; 
    let sum: i32 = xs.iter().filter_map(|x| x.parse::<i32>().ok()).sum();
    println!("sum = {sum}");
}
```
- Ошибки в библиотеках - `thiserror`
- Ошибки приложения - `anyhow` или `eyre` / `color-eyre`
